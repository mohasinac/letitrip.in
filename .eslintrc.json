{
  "extends": ["next/core-web-vitals", "plugin:@typescript-eslint/recommended"],
  "parser": "@typescript-eslint/parser",
  "parserOptions": {
    "ecmaVersion": "latest",
    "sourceType": "module",
    "project": "./tsconfig.json"
  },
  "plugins": ["@typescript-eslint"],
  "rules": {
    "react/no-unescaped-entities": "off",
    "@next/next/no-img-element": "warn",
    "react-hooks/exhaustive-deps": "warn",

    // ==========================================
    // SERVICE LAYER ARCHITECTURE RULES
    // ==========================================

    // Prevent direct apiService imports in components/pages/hooks
    // Note: Services can import api.service - this rule only applies to other layers
    "no-restricted-imports": [
      "error",
      {
        "patterns": [
          {
            "group": ["**/firebase/app", "@/app/api/lib/firebase/app"],
            "importNames": ["auth"],
            "message": "❌ Firebase Auth must be used server-side only. Authentication is handled via API routes. Only Realtime Database (for bidding) is allowed on client."
          },
          {
            "group": ["firebase/firestore"],
            "message": "❌ Firestore must be used server-side only (via firebase-admin). ALL database operations go through API routes. Use feature services (e.g., productsService) instead."
          },
          {
            "group": ["firebase/storage"],
            "message": "❌ Firebase Storage must be used server-side only. ALL file uploads go through API routes. Use mediaService.upload() instead."
          },
          {
            "group": ["firebase/auth"],
            "message": "❌ Firebase Auth SDK must be used server-side only. Use authService (which calls API routes) instead."
          }
        ],
        "paths": [
          {
            "name": "@/services/api.service",
            "message": "❌ Direct apiService imports not allowed in components/pages/hooks. Use feature-specific services (e.g., productsService, authService)."
          },
          {
            "name": "@/lib/socket-server",
            "message": "❌ socket-server is server-side only. Moved to @/app/api/lib/utils/socket-server."
          },
          {
            "name": "@/lib/auction-scheduler",
            "message": "❌ auction-scheduler is server-side only. Moved to @/app/api/lib/utils/auction-scheduler."
          },
          {
            "name": "@/lib/rate-limiter",
            "message": "❌ rate-limiter is server-side only. Moved to @/app/api/lib/utils/rate-limiter."
          },
          {
            "name": "@/lib/memory-cache",
            "message": "❌ memory-cache is server-side only. Moved to @/app/api/lib/utils/memory-cache."
          },
          {
            "name": "@/lib/shop-slug-resolver",
            "message": "❌ shop-slug-resolver is server-side only. Moved to @/app/api/lib/utils/shop-slug-resolver."
          },
          {
            "name": "@/lib/server-init",
            "message": "❌ server-init is server-side only. Moved to @/app/api/lib/utils/server-init."
          }
        ]
      }
    ],

    // ==========================================
    // CODE QUALITY RULES
    // ==========================================

    // Prevent console.log in production
    "no-console": [
      "warn",
      {
        "allow": ["warn", "error", "info"]
      }
    ],

    // Prevent unused variables (TypeScript-aware)
    "no-unused-vars": "off",
    "@typescript-eslint/no-unused-vars": [
      "warn",
      {
        "argsIgnorePattern": "^_",
        "varsIgnorePattern": "^_",
        "caughtErrors": "none"
      }
    ],

    // Prefer const over let
    "prefer-const": "warn",

    // Prevent var usage
    "no-var": "error",

    // ==========================================
    // NEXT.JS 15+ SPECIFIC RULES
    // ==========================================

    // Disable explicit any - too strict for gradual typing
    "@typescript-eslint/no-explicit-any": "off",

    // Warn on floating promises (helps catch unawaited params)
    "@typescript-eslint/no-floating-promises": "warn",

    // Enforce that params must be awaited (Next.js 15+ requirement)
    "@typescript-eslint/no-misused-promises": [
      "error",
      {
        "checksVoidReturn": false
      }
    ]
  },
  "overrides": [
    {
      "files": [
        "src/app/**/\\[*\\]/page.tsx",
        "src/app/api/**/\\[*\\]/route.ts"
      ],
      "rules": {
        "@typescript-eslint/no-floating-promises": "error",
        "@typescript-eslint/await-thenable": "error"
      }
    },
    {
      "files": ["src/services/**/*.ts"],
      "rules": {
        "no-restricted-imports": [
          "error",
          {
            "patterns": [
              {
                "group": ["firebase/firestore"],
                "message": "❌ Firestore must be used server-side only (via firebase-admin). ALL database operations go through API routes."
              },
              {
                "group": ["firebase/storage"],
                "message": "❌ Firebase Storage must be used server-side only. ALL file uploads go through API routes."
              },
              {
                "group": ["firebase/auth"],
                "message": "❌ Firebase Auth SDK must be used server-side only. Use authService (which calls API routes) instead."
              }
            ],
            "paths": [
              {
                "name": "@/lib/socket-server",
                "message": "❌ socket-server is server-side only. Moved to @/app/api/lib/utils/socket-server."
              },
              {
                "name": "@/lib/auction-scheduler",
                "message": "❌ auction-scheduler is server-side only. Moved to @/app/api/lib/utils/auction-scheduler."
              },
              {
                "name": "@/lib/rate-limiter",
                "message": "❌ rate-limiter is server-side only. Moved to @/app/api/lib/utils/rate-limiter."
              },
              {
                "name": "@/lib/memory-cache",
                "message": "❌ memory-cache is server-side only. Moved to @/app/api/lib/utils/memory-cache."
              },
              {
                "name": "@/lib/shop-slug-resolver",
                "message": "❌ shop-slug-resolver is server-side only. Moved to @/app/api/lib/utils/shop-slug-resolver."
              },
              {
                "name": "@/lib/server-init",
                "message": "❌ server-init is server-side only. Moved to @/app/api/lib/utils/server-init."
              }
            ]
          }
        ]
      }
    }
  ]
}
