{
  "rules": {
    ".read": false,
    ".write": false,
    
    "presence": {
      "$uid": {
        ".read": true,
        ".write": "auth != null && auth.uid == $uid",
        ".validate": "newData.hasChildren(['online', 'lastSeen'])",
        "online": {
          ".validate": "newData.isBoolean()"
        },
        "lastSeen": {
          ".validate": "newData.isNumber() || newData.val() == '.sv'"
        }
      }
    },
    
    "chat": {
      "$chatId": {
        ".read": "auth != null",
        ".write": false,
        "messages": {
          "$messageId": {
            ".write": "auth != null && !data.exists()",
            ".validate": "newData.hasChildren(['userId', 'message', 'timestamp'])",
            "userId": {
              ".validate": "newData.isString() && newData.val() == auth.uid"
            },
            "message": {
              ".validate": "newData.isString() && newData.val().length > 0 && newData.val().length <= 1000"
            },
            "timestamp": {
              ".validate": "newData.isNumber() || newData.val() == '.sv'"
            }
          }
        },
        "metadata": {
          ".read": "auth != null",
          ".write": "auth != null"
        }
      }
    },
    
    "notifications": {
      "$uid": {
        ".read": "auth != null && auth.uid == $uid",
        ".write": false,
        "$notificationId": {
          ".validate": "newData.hasChildren(['title', 'message', 'type', 'timestamp', 'read'])",
          "title": {
            ".validate": "newData.isString()"
          },
          "message": {
            ".validate": "newData.isString()"
          },
          "type": {
            ".validate": "newData.isString() && (newData.val() == 'info' || newData.val() == 'success' || newData.val() == 'warning' || newData.val() == 'error')"
          },
          "timestamp": {
            ".validate": "newData.isNumber() || newData.val() == '.sv'"
          },
          "read": {
            ".validate": "newData.isBoolean()",
            ".write": "auth != null && auth.uid == $uid"
          }
        }
      }
    },
    
    "live_updates": {
      "$updateType": {
        ".read": true,
        ".write": "auth != null",
        ".validate": "newData.hasChildren(['timestamp'])",
        "timestamp": {
          ".validate": "newData.isNumber() || newData.val() == '.sv'"
        }
      }
    }
  }
}
